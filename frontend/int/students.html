<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Учебная информационная система - Студенты</title>
    <style>
      :root {
        --gray-color: #9ea1a2;
        --red-color: #e41613;
        --blue-color: #0060ac;
        --dark-blue: #004080;
        --light-gray: #f5f5f5;
        --white: #ffffff;
        --green-grade: #4caf50;
        --yellow-grade: #ffc107;
        --orange-grade: #ff9800;
        --red-grade: #f44336;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--light-gray);
        color: #333;
      }
      .sidebar a {
        color: white;
        text-decoration: none;
      }

      .container {
        display: flex;
        min-height: 100vh;
      }

      /* Сайдбар */
      .sidebar {
        width: 250px;
        background-color: var(--blue-color);
        color: white;
        padding: 20px 0;
        transition: all 0.3s;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-header h2 {
        font-size: 1.5rem;
        display: flex;
        align-items: center;
      }

      .sidebar-header h2 i {
        margin-right: 10px;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-category {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.8rem;
        padding: 10px 20px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .menu-item {
        padding: 12px 20px;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .menu-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .menu-item.active {
        background-color: var(--dark-blue);
        border-left: 4px solid var(--red-color);
      }

      .menu-item i {
        margin-right: 10px;
        font-size: 1.1rem;
      }

      /* Основное содержимое */
      .main-content {
        flex: 1;
        padding: 20px;
      }

      /* Шапка */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--gray-color);
      }

      .header-title h1 {
        font-size: 1.8rem;
        color: var(--blue-color);
      }

      .header-actions {
        display: flex;
        align-items: center;
      }

      .user-profile {
        display: flex;
        align-items: center;
        margin-left: 20px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--gray-color);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        color: white;
        font-weight: bold;
      }

      /* Карточки статистики */
      .stats-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .stat-card-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
      }

      .stat-card-icon.students {
        background-color: var(--blue-color);
      }

      .stat-card-icon.groups {
        background-color: var(--red-color);
      }

      .stat-card-icon.teachers {
        background-color: var(--green-grade);
      }

      .stat-card-icon.disciplines {
        background-color: var(--orange-grade);
      }

      .stat-card-title {
        font-size: 0.9rem;
        color: var(--gray-color);
      }

      .stat-card-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #333;
      }

      /* Таблицы */
      .content-section {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--light-gray);
      }

      .section-title {
        font-size: 1.3rem;
        color: var(--blue-color);
      }

      .section-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 8px 16px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        display: flex;
        align-items: center;
        transition: all 0.2s;
      }

      .btn i {
        margin-right: 5px;
      }

      .btn-primary {
        background-color: var(--blue-color);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--dark-blue);
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid var(--gray-color);
        color: #333;
      }

      .btn-outline:hover {
        background-color: var(--light-gray);
      }

      .btn-danger {
        background-color: var(--red-color);
        color: white;
      }

      .btn-danger:hover {
        background-color: #c01210;
      }

      .search-box {
        position: relative;
        width: 250px;
      }

      .search-box input {
        width: 100%;
        padding: 8px 15px 8px 35px;
        border-radius: 4px;
        border: 1px solid var(--gray-color);
        outline: none;
      }

      .search-box i {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-color);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--light-gray);
      }

      th {
        background-color: var(--light-gray);
        font-weight: 600;
        color: #555;
      }

      tr:hover {
        background-color: rgba(0, 96, 172, 0.05);
      }

      .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
      }

      .status-active {
        background-color: rgba(76, 175, 80, 0.1);
        color: var(--green-grade);
      }

      .status-inactive {
        background-color: rgba(244, 67, 54, 0.1);
        color: var(--red-grade);
      }

      .pagination {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .pagination button {
        padding: 5px 10px;
        margin: 0 5px;
        border: 1px solid var(--gray-color);
        background-color: white;
        border-radius: 4px;
        cursor: pointer;
      }

      .pagination button.active {
        background-color: var(--blue-color);
        color: white;
        border-color: var(--blue-color);
      }

      /* Формы */
      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #555;
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--gray-color);
        border-radius: 4px;
        font-size: 1rem;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--blue-color);
        box-shadow: 0 0 0 2px rgba(0, 96, 172, 0.2);
      }

      .form-row {
        display: flex;
        gap: 20px;
      }

      .form-row .form-group {
        flex: 1;
      }

      /* Модальные окна */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      .modal2 {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: white;
        border-radius: 8px;
        width: 600px;
        max-width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 1.3rem;
        color: var(--blue-color);
      }

      .modal-body {
        padding: 20px;
      }

      .modal-footer {
        padding: 15px 20px;
        border-top: 1px solid var(--light-gray);
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      .btn-outline a {
        color: #333;
      }
      .btn-outline:hover {
        background-color: #0060ac;
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray-color);
      }
      .del:hover{
        background-color: #c01210;
      }
      .filters {
  display: flex;
  gap: 10px;
}

.filters select {
  padding: 8px;
  border-radius: 4px;
  border: 1px solid var(--gray-color);
  background-color: white;
  min-width: 150px;
}

@media (max-width: 768px) {
  .section-actions {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .filters {
    width: 100%;
    margin: 10px 0;
  }
  
  .filters select {
    width: 100%;
  }
}


      /* Адаптивность */
      @media (max-width: 1200px) {
        .stats-cards {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          padding: 10px 0;
        }

        .sidebar-menu {
          display: flex;
          overflow-x: auto;
          padding: 10px 0;
          white-space: nowrap;
        }

        .menu-category {
          display: none;
        }

        .menu-item {
          padding: 10px 15px;
        }

        .stats-cards {
          grid-template-columns: 1fr;
        }

        .section-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .search-box {
          width: 100%;
        }

        .form-row {
          flex-direction: column;
          gap: 0;
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- Сайдбар -->
      <div class="sidebar">
        <div class="sidebar-header">
          <h2><i class="fas fa-graduation-cap"></i> УИС</h2>
        </div>
        <div class="sidebar-menu">
          <div class="menu-category">Основное</div>
          <a href="index.html" class="menu-item">
            <i class="fas fa-home"></i> Главная
          </a>
          <a href="students.html" class="menu-item active">
            <i class="fas fa-users"></i> Студенты
          </a>
          <a href="groups.html" class="menu-item">
            <i class="fas fa-layer-group"></i> Группы
          </a>
          <a href="dis.html" class="menu-item">
            <i class="fas fa-book"></i> Дисциплины
          </a>
          <a href="teach.html" class="menu-item">
            <i class="fas fa-chalkboard-teacher"></i> Преподаватели
          </a>

          <div class="menu-category">Учебный процесс</div>
          <a href="programdisteach.html" class="menu-item">
            <i class="fas fa-tasks"></i> Программы дисциплин
          </a>
          <a href="nagr.html" class="menu-item">
            <i class="fas fa-chart-bar"></i> Нагрузка
          </a>
          <a href="kons.html" class="menu-item">
            <i class="fas fa-question-circle"></i> Консультации
          </a>
          <a href="skip.html" class="menu-item">
            <i class="fas fa-user-times"></i> Пропуски
          </a>
          <a href="marks.html" class="menu-item">
            <i class="fas fa-star"></i> Оценки
          </a>
        </div>
      </div>

      <!-- Основное содержимое -->
      <div class="main-content">
        <!-- Шапка -->
        <div class="header">
          <div class="header-title">
            <h1>Студенты</h1>
            <p>Информация о студентах</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Поиск..." />
            </div>
            <div class="user-profile">
              <div class="user-avatar">ИП</div>
              <div class="user-info">
                <div class="user-name">Иванов П.С.</div>
                <div class="user-role">Преподаватель</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Студенты -->
        <div class="content-section">
  <div class="section-header">
    <h3 class="section-title">Студенты</h3>
    <div class="section-actions">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Поиск по ФИО..." id="searchInput">
      </div>
      <div class="filters">
        <select id="groupFilter" class="form-control">
          <option value="">Все группы</option>
        </select>
        <select id="statusFilter" class="form-control">
          <option value="">Все студенты</option>
          <option value="active">Активные</option>
          <option value="expelled">Отчисленные</option>
        </select>
      </div>
      <button class="btn btn-primary" id="addStudentBtn">
        <i class="fas fa-plus"></i> Добавить студента
      </button>
    </div>
  </div>
  <!-- Таблица остается без колонки статуса -->
  <table>
    <thead>
      <tr>
        <th>№</th>
        <th>ФИО</th>
        <th>Группа</th>
        <th>Дата отчисления</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody id="students">
      <!-- Данные будут загружаться через JS -->
    </tbody>
  </table>
</div>
    <!-- Модальное окно добавления студента -->
    <div class="modal" id="addStudentModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Добавить студента</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-row">
              <div class="form-group">
                <label>ФИО *</label>
                <input
                  type="text"
                  class="form-control"
                  required
                  id="sendName"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Группа</label>
                <select class="form-control" id="add-student">
                  <option>ИСП-31.2</option>
                  <option>ИСП-31.4</option>
                  <option>ИСВ-29.1</option>
                  <option>ИСВ-29.2</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Дата отчисления</label>
              <input type="date" class="form-control" id="sendDate" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline">Отмена</button>
          <button class="btn btn-primary" id="sendStudent">Сохранить</button>
        </div>
      </div>
    </div>

    <div class="modal2" id="addStudentModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Редактировать студента</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form>
            <input type="hidden" id="ID">
            <div class="form-row">
              <div class="form-group">
                <label>ФИО *</label>
                <input
                  type="text"
                  class="form-control"
                  required
                  id="updateName"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Группа</label>
                <select class="form-control" id="update-student">
                  <option>ИСП-31.2</option>
                  <option>ИСП-31.4</option>
                  <option>ИСВ-29.1</option>
                  <option>ИСВ-29.2</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Дата отчисления</label>
              <input type="date" class="form-control" id="updateDate" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline">Отмена</button>
          <button class="btn btn-primary" id="updateStudent">Сохранить</button>
        </div>
      </div>
    </div>

    <script>
      let listGroups = [];
      const dir = "../../controllers/";
      document.addEventListener("DOMContentLoaded", function () {
        fetch(dir + "GroupController.php?action=get")
          .then((res) => {
            if (!res.ok) {
              throw new Error("Network response was not ok");
            }
            return res.json();
          })
          .then((students) => {
            const select = document.getElementById("add-student");
            const select2 = document.getElementById("update-student");
            select.innerHTML = '<option value="">Выберите группу</option>';
            select2.innerHTML = '<option value="">Выберите группу</option>';
            students.forEach((student) => {
              const row = `
               <option value="${student.ID}">${student.Name}</option>`;
              select.insertAdjacentHTML("beforeend", row);
              select2.insertAdjacentHTML("beforeend", row);
            });
            listGroups = students;
          })
          .catch((err) => console.error("Failed to fetch students:", err));
      });
      // Основная функция загрузки студентов
function fetchStudents() {
  fetch("../../controllers/StudentController.php?action=get")
    .then(res => res.json())
    .then(students => {
      window.allStudents = students; // Сохраняем для фильтрации
      renderStudents(students);
      initFilters(students);
    });
}

// Рендер таблицы
function renderStudents(students) {
  const tbody = document.getElementById("students");
  tbody.innerHTML = "";

  students.forEach(student => {
    const row = `
      <tr class="elemsList" data-group="${student.GroupID}" 
          data-status="${student.ExpulsionDate ? 'expelled' : 'active'}">
        <td>${student.ID}</td>
        <td>${student.FullName}</td>
        <td>${student.GroupID}</td>
        <td>${student.ExpulsionDate || '-'}</td>
        <td>
          <button class="btn btn-outline">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-outline del">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>`;
    tbody.insertAdjacentHTML("beforeend", row);
  });
}

// Инициализация фильтров
function initFilters(students) {
  const groupFilter = document.getElementById('groupFilter');
  
  // Получаем уникальные группы
  const groups = [...new Set(students.map(s => s.GroupID))];
  groups.forEach(group => {
    groupFilter.innerHTML += `<option value="${group}">${group}</option>`;
  });

  // Вешаем обработчики
  document.getElementById('groupFilter').addEventListener('change', applyFilters);
  document.getElementById('statusFilter').addEventListener('change', applyFilters);
  document.getElementById('searchInput').addEventListener('input', applyFilters);
}

// Применение фильтров
function applyFilters() {
  const groupValue = document.getElementById('groupFilter').value;
  const statusValue = document.getElementById('statusFilter').value;
  const searchValue = document.getElementById('searchInput').value.toLowerCase();

  document.querySelectorAll('.elemsList').forEach(row => {
    const groupMatch = !groupValue || row.dataset.group === groupValue;
    const statusMatch = !statusValue || row.dataset.status === statusValue;
    const nameMatch = !searchValue || 
                     row.cells[1].textContent.toLowerCase().includes(searchValue);

    row.style.display = (groupMatch && statusMatch && nameMatch) ? '' : 'none';
  });
}

// Инициализация при загрузке
document.addEventListener("DOMContentLoaded", fetchStudents);


      document.addEventListener("DOMContentLoaded", function () {
        // Пример обработчика для меню

        // Пример обработчика для модального окна
        const closeModalButtons = document.querySelectorAll(
          ".close-modal, .btn-outline"
        );
        closeModalButtons.forEach((button) => {
          button.addEventListener("click", function () {
            document.querySelectorAll(".modal").forEach((modal) => {
              modal.style.display = "none";
            });
            document.querySelectorAll(".modal2").forEach((modal) => {
              modal.style.display = "none";
            });
          });
        });

        // Пример: открытие модального окна при клике на "Добавить студента"
        document
          .getElementById("addStudentBtn")
          .addEventListener("click", function () {
            document.getElementById("addStudentModal").style.display = "flex";
          });
      });

      document.getElementById("sendStudent").addEventListener("click", () => {
        $name = document.querySelector("#sendName").value;
        $group = document.getElementById("add-student").value;
        $date = document.getElementById("sendDate").value;

        fetch(dir + "StudentController.php?action=addStudent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: $name,
            group: $group,
            date: $date,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              // Проверяем HTTP-статус (200-299)
              throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const contentType = response.headers.get("content-type");
            if (!contentType || !contentType.includes("application/json")) {
              throw new TypeError(
                "Ожидался JSON, но сервер вернул: " + contentType
              );
            }

            return response.json();
          })
          .then((data) => {
            if (data.success) {
              location.reload();
            } else {
              console.log(data);
            }
          })
          .catch((error) => {
            console.error("Fetch error:", error);
          });
      });
      document.querySelector('#updateStudent').addEventListener('click',()=>{
                $name = document.querySelector("#updateName").value;
        $group = document.getElementById("update-student").value;
        $date = document.getElementById("updateDate").value;
        $id = document.getElementById("ID").value;
        fetch(dir + "StudentController.php?action=updateStudent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            id: $id,
            name: $name,
            group: $group,
            date: $date,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              // Проверяем HTTP-статус (200-299)
              throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const contentType = response.headers.get("content-type");
            if (!contentType || !contentType.includes("application/json")) {
              throw new TypeError(
                "Ожидался JSON, но сервер вернул: " + contentType
              );
            }

            return response.json();
          })
          .then((data) => {
            if (data.success) {
              location.reload();
            } else {
              console.log(data);
            }
          })
          .catch((error) => {
            console.error("Fetch error:", error);
          });
      })


      function delStudent(id){
        fetch(dir + "StudentController.php?action=delStudent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            id: id
          }),
        })
          .then((response) => {
            if (!response.ok) {
              // Проверяем HTTP-статус (200-299)
              throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const contentType = response.headers.get("content-type");
            if (!contentType || !contentType.includes("application/json")) {
              throw new TypeError(
                "Ожидался JSON, но сервер вернул: " + contentType
              );
            }

            return response.json();
          })
          .then((data) => {
            console.log(data);
            if (data.success) {
              location.reload();
            } else {
              console.log(data);
            }
          })
          .catch((error) => {
            console.error("Fetch error:", error);
          });
      }
    </script>
  </body>
</html>
